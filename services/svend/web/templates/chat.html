<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Svend - Reasoning Assistant</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --bg-primary: #0a0f0a;
            --bg-secondary: #0d120d;
            --bg-tertiary: #121a12;
            --bg-hover: #1a261a;
            --accent-primary: #4a9f6e;
            --accent-primary-dim: rgba(74, 159, 110, 0.15);
            --accent-primary-border: rgba(74, 159, 110, 0.3);
            --accent-blue: #3a7f8f;
            --accent-red: #d06060;
            --text-primary: #e8efe8;
            --text-secondary: #9aaa9a;
            --text-dim: #7a8f7a;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
        }

        /* Sidebar */
        .sidebar {
            width: 260px;
            background: var(--bg-secondary);
            border-right: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
        }

        .sidebar-header {
            padding: 1.25rem 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.1rem;
            font-weight: 300;
            letter-spacing: 0.3em;
            color: var(--text-primary);
        }

        .logo-icon {
            width: 1.25rem;
            height: 1.25rem;
            flex-shrink: 0;
        }

        .logo-icon svg {
            width: 100%;
            height: 100%;
            fill: none;
            stroke: var(--text-primary);
            stroke-width: 20;
        }

        .new-chat-btn {
            width: 100%;
            padding: 0.75rem 1rem;
            margin-top: 1rem;
            background: var(--accent-primary-dim);
            border: 1px solid var(--accent-primary-border);
            border-radius: 4px;
            color: var(--accent-primary);
            font-family: inherit;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .new-chat-btn:hover { background: rgba(74, 159, 110, 0.25); }

        .chat-history {
            flex: 1;
            overflow-y: auto;
            padding: 0.5rem;
        }

        .chat-history-item {
            padding: 0.75rem 1rem;
            border-radius: 4px;
            color: var(--text-secondary);
            font-size: 0.85rem;
            cursor: pointer;
            margin-bottom: 0.25rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            transition: all 0.15s;
        }

        .chat-history-item:hover { background: var(--bg-hover); color: var(--text-primary); }
        .chat-history-item.active { background: var(--accent-primary-dim); color: var(--text-primary); }

        .sidebar-footer {
            padding: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem;
            border-radius: 4px;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--accent-primary-dim);
            border: 1px solid var(--accent-primary-border);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            color: var(--accent-primary);
        }

        .user-name { font-size: 0.85rem; color: var(--text-primary); }
        .user-tier { font-size: 0.7rem; color: var(--text-dim); }

        /* Main Chat Area */
        .main {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-width: 0;
        }

        .chat-header {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .chat-title { font-size: 0.9rem; font-weight: 400; color: var(--text-primary); }

        /* Messages */
        .messages {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .message {
            max-width: 800px;
            width: 100%;
            margin: 0 auto;
        }

        .message-user {
            display: flex;
            justify-content: flex-end;
        }

        .message-user .message-content {
            background: var(--bg-tertiary);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 12px 12px 4px 12px;
            padding: 1rem 1.25rem;
            max-width: 70%;
        }

        .message-assistant {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .message-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .assistant-icon {
            width: 24px;
            height: 24px;
            border-radius: 4px;
            background: var(--accent-primary-dim);
            border: 1px solid var(--accent-primary-border);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
        }

        .assistant-name { font-size: 0.8rem; font-weight: 500; color: var(--text-secondary); }

        /* Metadata Badge */
        .message-meta {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
            flex-wrap: wrap;
        }

        .meta-badge {
            font-size: 0.7rem;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            background: var(--bg-tertiary);
            border: 1px solid rgba(255, 255, 255, 0.05);
            color: var(--text-dim);
        }

        .meta-badge.domain { border-color: var(--accent-primary-border); color: var(--accent-primary); }
        .meta-badge.blocked { border-color: var(--error-border); color: var(--error); background: var(--error-dim); }
        .meta-badge.verified { border-color: var(--accent-primary-border); color: var(--accent-primary); }

        .assistant-response {
            line-height: 1.6;
            color: var(--text-primary);
        }

        .assistant-response.blocked {
            color: var(--accent-red);
            font-style: italic;
        }

        .assistant-response p {
            margin: 0.5em 0;
        }

        .assistant-response h2, .assistant-response h3, .assistant-response h4 {
            margin: 1em 0 0.5em;
            color: var(--accent-primary);
        }

        /* KaTeX math rendering */
        .katex-display {
            margin: 1em 0;
            padding: 0.5em;
            background: rgba(74, 159, 110, 0.05);
            border-radius: 4px;
            overflow-x: auto;
        }

        .katex-inline {
            padding: 0 0.2em;
        }

        .katex {
            font-size: 1.1em;
        }

        /* Code blocks */
        .code-block {
            background: #0d1117;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            margin: 1rem 0;
            overflow: hidden;
        }

        .code-header {
            background: rgba(255, 255, 255, 0.05);
            padding: 0.5rem 1rem;
            font-size: 0.75rem;
            color: var(--text-dim);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .code-header .lang {
            font-family: 'JetBrains Mono', monospace;
        }

        .code-content {
            padding: 1rem;
            overflow-x: auto;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            line-height: 1.5;
            color: #e6edf3;
        }

        .code-content pre {
            margin: 0;
            white-space: pre-wrap;
            word-break: break-word;
        }

        /* Visualization images */
        .visualization-container {
            margin: 1rem 0;
        }

        .visualization-img {
            max-width: 100%;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background: #1a1a2e;
        }

        .visualization-label {
            font-size: 0.75rem;
            color: var(--text-dim);
            margin-top: 0.5rem;
            text-align: center;
        }

        /* Cognition mode badges */
        .meta-badge.executive {
            background: rgba(138, 99, 210, 0.2);
            color: #b794f6;
            border-color: rgba(138, 99, 210, 0.4);
        }

        .meta-badge.cognition {
            background: rgba(74, 159, 110, 0.2);
            color: var(--accent-primary);
            border-color: var(--accent-primary-border);
        }

        /* Mode selector */
        .mode-selector {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            justify-content: center;
        }

        .mode-btn {
            padding: 0.35rem 0.75rem;
            border-radius: 4px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background: transparent;
            color: var(--text-dim);
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .mode-btn:hover {
            border-color: rgba(255, 255, 255, 0.2);
            color: var(--text-secondary);
        }

        .mode-btn.active {
            background: var(--accent-primary-dim);
            border-color: var(--accent-primary-border);
            color: var(--accent-primary);
        }

        .mode-btn.active.executive {
            background: rgba(138, 99, 210, 0.15);
            border-color: rgba(138, 99, 210, 0.4);
            color: #b794f6;
        }

        .mode-btn.executive {
            color: #b794f6;
        }

        /* Input Area */
        .input-area {
            padding: 1.5rem;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }

        .input-container {
            max-width: 800px;
            margin: 0 auto;
            display: flex;
            gap: 0.75rem;
        }

        .model-selector {
            background: var(--bg-secondary);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            color: var(--text-secondary);
            padding: 0 0.75rem;
            font-size: 0.8rem;
            cursor: pointer;
        }

        .model-selector:focus {
            border-color: var(--accent-primary-border);
            outline: none;
        }

        .input-wrapper {
            flex: 1;
            background: var(--bg-secondary);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            display: flex;
            align-items: center;
            padding: 0 1rem;
            transition: border-color 0.2s;
        }

        .input-wrapper:focus-within {
            border-color: var(--accent-primary-border);
        }

        .message-input {
            flex: 1;
            background: transparent;
            border: none;
            color: var(--text-primary);
            font-family: inherit;
            font-size: 0.9rem;
            padding: 1rem 0;
            outline: none;
        }

        .message-input::placeholder { color: var(--text-dim); }

        .send-btn {
            width: 48px;
            height: 48px;
            border-radius: 8px;
            background: var(--accent-primary);
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .send-btn:hover { background: #5ab37e; }
        .send-btn:disabled { background: var(--text-dim); cursor: not-allowed; }

        /* Loading indicator */
        .loading {
            display: flex;
            gap: 0.3rem;
            padding: 1rem 0;
        }

        .loading span {
            width: 8px;
            height: 8px;
            background: var(--accent-primary);
            border-radius: 50%;
            animation: bounce 1.4s infinite ease-in-out both;
        }

        .loading span:nth-child(1) { animation-delay: -0.32s; }
        .loading span:nth-child(2) { animation-delay: -0.16s; }

        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }

        /* Welcome state */
        .welcome {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 2rem;
        }

        .welcome h1 {
            font-size: 2rem;
            font-weight: 300;
            letter-spacing: 0.3em;
            margin-bottom: 1rem;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .welcome .logo-icon {
            width: 2rem;
            height: 2rem;
        }

        .welcome .logo-icon svg {
            stroke: var(--accent-primary);
        }

        .welcome p {
            color: var(--text-secondary);
            max-width: 500px;
            line-height: 1.6;
        }

        /* Auth forms */
        .auth-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--bg-secondary);
            padding: 2rem;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            width: 360px;
        }

        .auth-container h2 {
            margin-bottom: 0.5rem;
            font-weight: 300;
            color: var(--text-primary);
            letter-spacing: 0.2em;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .auth-container .logo-icon {
            width: 1.5rem;
            height: 1.5rem;
        }

        .auth-container .logo-icon svg {
            stroke: var(--text-primary);
        }

        .auth-container .version-tag {
            font-size: 0.65rem;
            color: var(--text-dim);
            letter-spacing: 0.15em;
            margin-top: 0.25rem;
            font-weight: 400;
        }

        .auth-container .subtitle {
            color: var(--text-dim);
            font-size: 0.85rem;
            margin-bottom: 1.5rem;
        }

        .auth-container input {
            width: 100%;
            padding: 0.75rem 1rem;
            margin-bottom: 1rem;
            background: var(--bg-tertiary);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            color: var(--text-primary);
            font-family: inherit;
            font-size: 0.9rem;
        }

        .auth-container input:focus {
            outline: none;
            border-color: var(--accent-primary-border);
        }

        .auth-container input::placeholder {
            color: var(--text-dim);
        }

        .invite-code-input {
            font-family: 'JetBrains Mono', monospace;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            text-align: center;
            font-size: 1.1rem !important;
        }

        .auth-container button {
            width: 100%;
            padding: 0.75rem;
            background: var(--accent-primary);
            border: none;
            border-radius: 4px;
            color: white;
            font-family: inherit;
            font-size: 0.9rem;
            cursor: pointer;
            transition: background 0.2s;
        }

        .auth-container button:hover {
            background: #5ab37e;
        }

        .auth-container button:disabled {
            background: var(--text-dim);
            cursor: not-allowed;
        }

        .auth-toggle {
            margin-top: 1.5rem;
            text-align: center;
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        .auth-toggle a {
            color: var(--accent-primary);
            text-decoration: none;
            cursor: pointer;
        }

        .auth-toggle a:hover {
            text-decoration: underline;
        }

        .error-msg {
            color: var(--accent-red);
            font-size: 0.85rem;
            margin-bottom: 1rem;
            padding: 0.5rem;
            background: var(--error-dim);
            border-radius: 4px;
        }

        .success-msg {
            color: var(--accent-primary);
            font-size: 0.85rem;
            margin-bottom: 1rem;
            padding: 0.5rem;
            background: var(--accent-primary-dim);
            border-radius: 4px;
        }

        .hidden { display: none !important; }

        /* Background for auth screen */
        .auth-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            background: var(--bg-primary);
            overflow: hidden;
        }

        .auth-background .aurora {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 60%;
            opacity: 0.12;
            background: linear-gradient(
                180deg,
                transparent 0%,
                #4a9f6e 20%,
                #3a7f8f 40%,
                #5a4f7f 60%,
                transparent 100%
            );
            filter: blur(60px);
            animation: aurora-drift 20s ease-in-out infinite;
        }

        @keyframes aurora-drift {
            0%, 100% {
                transform: translateX(-5%) scaleY(1);
                opacity: 0.10;
            }
            33% {
                transform: translateX(5%) scaleY(1.1);
                opacity: 0.15;
            }
            66% {
                transform: translateX(-3%) scaleY(0.95);
                opacity: 0.08;
            }
        }

        /* Fireflies */
        .fireflies {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .firefly {
            position: absolute;
            width: 4px;
            height: 4px;
            border-radius: 50%;
            pointer-events: none;
            animation: firefly-float 10s ease-in-out infinite;
        }

        .firefly::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            height: 100%;
            border-radius: 50%;
            animation: firefly-glow 3s ease-in-out infinite;
        }

        @keyframes firefly-float {
            0%, 100% {
                transform: translate(0, 0) scale(1);
            }
            25% {
                transform: translate(30px, -20px) scale(1.1);
            }
            50% {
                transform: translate(-20px, -40px) scale(0.9);
            }
            75% {
                transform: translate(40px, -10px) scale(1.05);
            }
        }

        @keyframes firefly-glow {
            0%, 100% {
                opacity: 0;
                box-shadow: none;
            }
            15%, 85% {
                opacity: 0;
            }
            30%, 70% {
                opacity: 1;
                box-shadow:
                    0 0 6px 3px currentColor,
                    0 0 12px 6px currentColor,
                    0 0 20px 10px rgba(232, 197, 71, 0.3);
            }
            50% {
                opacity: 1;
                box-shadow:
                    0 0 8px 4px currentColor,
                    0 0 16px 8px currentColor,
                    0 0 30px 15px rgba(232, 197, 71, 0.4);
            }
        }
    </style>
    <!-- KaTeX for LaTeX rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
</head>
<body>
    <!-- Background with fireflies (for auth screen) -->
    <div id="authBackground" class="auth-background">
        <div class="aurora"></div>
        <div class="fireflies" id="fireflies"></div>
    </div>

    <!-- Auth Forms -->
    <div id="authContainer" class="auth-container">
        <!-- Register Form (shown first for alpha) -->
        <div id="registerForm">
            <h2><span class="logo-icon"><svg viewBox="590 180 400 680" xmlns="http://www.w3.org/2000/svg"><path d="m 810.34961,183.98438 c -8.00929,0.28308 -15.5701,3.48413 -22.48495,7.32376 -12.87788,7.1817 -24.40922,16.65459 -37.84868,22.84732 -4.31757,2.08674 -9.12821,2.91574 -13.3771,5.16756 -7.15857,3.4834 -13.4768,8.9205 -17.4074,15.89893 -4.63628,8.03202 -6.3024,17.46727 -6.06699,26.65644 0.0985,4.79617 0.75632,9.56171 1.64764,14.269 0.0476,1.43947 -0.58472,2.80552 -0.6551,4.24336 -0.75319,5.38879 0.11601,11.14811 3.19493,15.71841 3.74987,5.93489 9.53028,10.16542 15.27939,14.00871 10.15322,6.72796 21.26277,12.12274 30.43779,20.24424 0.72261,0.57357 1.06428,1.45781 1.01481,2.36706 0.25419,10.62114 0.26429,21.24817 0.15168,31.87217 -0.10997,9.76491 -0.23395,19.53062 -0.32352,29.29514 -0.2559,2.18138 -2.48681,3.93272 -4.67536,3.50098 -1.73761,-0.32579 -2.97662,-1.73361 -4.40792,-2.66331 -35.6616,-26.03244 -71.15984,-52.30412 -107.51397,-77.36576 -1.79592,-1.18526 -3.52006,-2.4953 -5.36053,-3.6031 -2.38777,-1.13215 -5.02429,-1.65761 -7.63204,-1.97563 -6.86268,-0.69881 -13.69347,1.24508 -19.88444,4.07709 -9.03352,4.05728 -17.18145,9.7518 -25.58752,14.92132 -3.36838,2.10086 -6.87005,4.24739 -10.41869,6.1631 -0.99569,0.52942 -2.22,1.17581 -3.31848,1.71944 -4.07079,2.03607 -8.31873,3.71411 -12.69879,4.95454 -4.02638,1.19323 -7.8786,3.2257 -10.74869,6.34031 -2.96251,3.09048 -4.72915,7.11427 -5.71781,11.23537 -1.55545,6.40335 -1.57897,13.05115 -1.41863,19.6009 0.26795,9.17433 1.23843,18.2732 1.00241,27.46227 0.0207,3.42545 -1.03941,6.75735 -0.90681,10.1895 0.001,5.08446 1.56132,10.25252 4.8747,14.1707 4.43736,5.53069 10.76398,9.06598 17.04291,12.11545 11.82295,5.71965 24.58514,9.32817 36.12161,15.66465 2.63761,1.56679 5.14743,3.4485 8.1405,4.29671 4.09389,1.33597 8.5369,1.2958 12.69456,0.26955 7.31277,-1.64267 13.9237,-5.32376 20.51953,-8.74387 4.35604,-2.28907 8.66919,-4.70056 13.22314,-6.57805 2.19027,-0.44436 4.29633,0.48096 6.39883,0.88652 1.12616,0.30405 2.24944,0.63792 3.42471,1.02929 9.89759,3.32419 18.80495,8.95253 27.35797,14.83159 9.60214,6.67635 18.83584,13.8873 28.67442,20.21701 1.81523,1.44232 2.01025,4.45281 0.29511,6.05269 -1.18127,1.12727 -2.69962,1.81802 -4.02559,2.7576 -20.09966,13.11068 -40.67378,25.47586 -60.8399,38.48291 -9.96369,-3.64417 -18.76816,-9.70519 -28.31054,-14.23828 -5.34352,-2.47216 -11.27535,-4.34129 -17.22237,-3.5115 -2.23037,0.31113 -4.43888,1.00335 -6.29472,2.30511 -9.41413,5.6132 -20.00552,8.69886 -30.20947,12.5061 -7.8109,2.84323 -15.72475,5.92179 -22.32775,11.09558 -4.14348,3.33658 -7.40401,8.02695 -8.19394,13.36751 -0.75011,4.4178 0.0808,8.89125 -0.11393,13.33558 -0.0446,2.47431 -0.1663,4.78571 -0.33618,7.26123 -0.7016,9.88267 -2.18914,19.87652 -1.92566,29.86437 0.15833,5.61102 0.98818,11.38546 3.72433,16.36565 2.44787,4.28244 6.64099,7.37128 11.27534,8.93309 2.96165,1.01936 5.95313,1.9621 8.82273,3.22974 16.61941,6.96981 31.54004,17.40843 48.2906,24.09353 8.35504,3.30306 17.3626,5.41067 26.39188,4.73995 1.59654,-0.65955 2.95687,-1.7592 4.46121,-2.59492 34.97252,-21.48909 67.36925,-46.77662 100.70996,-70.64113 2.40223,-1.72533 4.80662,-3.4479 7.20969,-5.17216 3.12283,0.94464 6.45003,2.34189 8.1566,5.30326 2.63181,4.23393 2.95848,9.37168 3.10974,14.22553 0.0833,3.31727 0.004,6.60823 -0.11791,9.87356 -0.21995,6.79385 -0.7923,13.61211 -0.125,20.39843 0.20259,2.16638 0.20474,4.521 -0.33146,6.70372 -1.0519,4.92922 -3.98913,9.33555 -7.88721,12.48684 -4.60501,3.92369 -10.18337,6.53657 -15.54322,9.09565 -5.27007,2.60362 -10.87123,4.82949 -15.34311,8.75008 -3.14872,2.8351 -5.29862,6.60832 -6.92578,10.47774 -3.38575,8.39922 -4.00047,17.60263 -3.79623,26.56693 0.33468,12.34083 2.50879,24.53129 4.78404,36.63584 23.29475,15.98048 48.86901,28.22319 74.1637,40.59903 3.68993,1.78904 7.35713,3.65372 11.08044,5.36581 1.3382,0.36422 2.72081,0.68421 4.08264,0.85588 14.97883,-4.04776 28.84434,-11.24143 42.34205,-18.73961 11.53711,-6.35617 22.86975,-13.13079 34.83628,-18.66637 4.22894,-1.55707 8.44379,-3.61358 11.45999,-7.06209 4.09602,-4.4785 5.93166,-10.51995 6.66278,-16.43202 0.92354,-7.35214 0.49188,-14.78778 -0.0139,-22.15442 -0.67411,-9.31054 -1.67798,-18.63084 -1.29362,-27.9791 -5.24479,-6.86889 -12.45843,-11.86973 -19.80582,-16.25267 -5.70939,-3.42205 -11.57773,-6.5755 -17.2495,-9.97521 -3.48793,-2.1042 -6.91214,-4.29698 -10.24384,-6.71085 -0.72961,-0.25274 -0.3909,-1.04781 -0.45847,-1.63664 0.10339,-17.34117 -0.25832,-34.68823 0.31622,-52.02424 0.0871,-2.86433 0.24803,-5.86427 0.35547,-8.77734 0.24524,-1.51291 0.97602,-2.92863 1.82743,-4.17922 1.01119,-0.96492 2.69388,-0.72675 3.64269,0.20957 13.7572,9.30561 27.45185,18.70282 41.06504,28.21769 14.32134,10.01422 28.62533,20.04233 42.89178,30.13048 9.85111,7.13736 19.42479,14.89572 30.55621,19.99718 6.32797,2.8654 13.46903,4.59642 20.40357,3.28445 5.01892,-0.91491 9.51952,-3.53842 13.56592,-6.54339 4.1904,-2.64327 8.6938,-4.74592 13.1878,-6.81289 12.49,-5.62316 25.6326,-9.85522 37.5685,-16.66375 6.6826,-3.86072 12.9614,-8.79041 17.159,-15.36138 0.077,-0.98215 -0.1432,-2.04092 -0.1765,-3.05218 -1.0891,-15.56938 0.8661,-31.18693 -0.42,-46.74805 -0.6817,-7.73457 -2.3041,-15.61186 -6.4028,-22.31119 -0.698,-1.07942 -1.3987,-2.21543 -2.2632,-3.14351 -6.5959,-2.34922 -12.9212,-5.37852 -19.1484,-8.56287 -8.7431,-4.45721 -17.485,-9.32684 -26.689,-12.95173 -7.9225,-3.0727 -16.4727,-5.18735 -25.01999,-4.27874 -0.69625,0.0946 -1.45907,0.031 -1.9507,0.62492 -1.86973,1.50356 -4.00206,2.99524 -5.93993,4.18562 -3.11255,1.91641 -6.61385,3.63178 -10.16309,4.85819 -5.17482,1.81524 -10.69246,2.62925 -16.17089,2.39377 -0.76721,-0.0353 -1.83478,-0.10813 -2.71485,-0.19727 -8.76802,-0.87792 -17.09685,-4.23876 -24.66465,-8.63987 -6.70946,-3.87704 -12.94638,-8.62728 -18.84121,-13.55739 -5.3555,-2.04179 -10.86973,-4.46433 -14.67498,-8.91892 -2.71108,-3.28176 -3.6238,-8.13451 -1.72969,-12.03365 1.92136,-4.4162 5.87455,-7.47217 9.75916,-10.09482 7.41881,-4.95593 15.60058,-8.5845 23.40489,-12.86517 3.87755,-2.08906 7.78444,-4.23221 11.15815,-7.08878 2.01088,-1.89507 3.89167,-4.04315 6.46834,-5.18776 3.79471,-1.90744 8.31932,-2.18549 12.35001,-0.87941 6.3308,1.82617 11.47084,6.14955 17.28242,9.06683 1.89042,0.93426 3.95479,1.46325 5.78158,2.52681 6.71632,3.31352 14.54253,4.15556 21.85253,2.61957 9.4786,-1.84944 18.1485,-6.35056 26.5334,-10.96985 11.3346,-6.30144 22.2737,-13.46349 34.3962,-18.21392 4.2955,-10.61758 5.7235,-22.14012 6.0312,-33.51651 0.3858,-15.15412 -1.1682,-30.25794 -2.2616,-45.35263 -12.3858,-9.88221 -26.6329,-16.99787 -40.689,-24.14553 -9.5,-4.83571 -19.0575,-9.61979 -28.0582,-15.35042 -6.12007,-4.66644 -14.05816,-6.41988 -21.64672,-5.96219 -1.19198,-0.0473 -2.37843,0.32604 -3.2616,1.13778 -38.22332,26.10576 -75.04874,54.16648 -112.57695,81.24614 -2.71304,0.6413 -5.49842,-0.66111 -7.54085,-2.3846 -2.98399,-2.60674 -4.29719,-6.57185 -4.74676,-10.40275 -0.82369,-5.94443 -0.34169,-11.84447 -0.0213,-17.79103 0.33714,-6.47411 1.01497,-12.99967 0.0809,-19.45673 -0.74071,-5.92858 1.52712,-12.06105 5.76034,-16.24201 4.84104,-4.96478 11.25754,-7.86952 17.35846,-10.94667 3.99683,-2.00052 8.09479,-3.99903 11.43912,-7.01665 0.99698,-0.95764 1.86712,-2.07596 3.12921,-2.70104 5.52795,-3.56549 9.52876,-9.28516 11.25959,-15.60778 2.32363,-7.95342 2.23731,-16.36205 1.6583,-24.55425 -0.85794,-10.76518 -2.81251,-21.40013 -4.13281,-32.11133 -21.60154,-15.33596 -45.2301,-27.50365 -68.56022,-39.89174 -5.52038,-2.93006 -11.02072,-5.90598 -16.52315,-8.86385 -2.21137,-0.75553 -4.61644,-0.71584 -6.9264,-0.73464 z"/></svg></span>SVEND</h2>
            <p class="version-tag">Version ALPHA | Winter's Shadow</p>
            <p class="subtitle">Enter your invite code to create an account</p>
            <div id="registerError" class="error-msg hidden"></div>
            <div id="registerSuccess" class="success-msg hidden"></div>
            <input type="text" id="regInviteCode" class="invite-code-input" placeholder="XXXX-XXXX" maxlength="9">
            <input type="text" id="regUsername" placeholder="Choose a username">
            <input type="email" id="regEmail" placeholder="Email (optional)">
            <input type="password" id="regPassword" placeholder="Password (8+ characters)">
            <button onclick="register()">Create Account</button>
            <div class="auth-toggle">
                Already have an account? <a onclick="showLogin()">Sign in</a>
            </div>
        </div>

        <!-- Login Form -->
        <div id="loginForm" class="hidden">
            <h2><span class="logo-icon"><svg viewBox="590 180 400 680" xmlns="http://www.w3.org/2000/svg"><path d="m 810.34961,183.98438 c -8.00929,0.28308 -15.5701,3.48413 -22.48495,7.32376 -12.87788,7.1817 -24.40922,16.65459 -37.84868,22.84732 -4.31757,2.08674 -9.12821,2.91574 -13.3771,5.16756 -7.15857,3.4834 -13.4768,8.9205 -17.4074,15.89893 -4.63628,8.03202 -6.3024,17.46727 -6.06699,26.65644 0.0985,4.79617 0.75632,9.56171 1.64764,14.269 0.0476,1.43947 -0.58472,2.80552 -0.6551,4.24336 -0.75319,5.38879 0.11601,11.14811 3.19493,15.71841 3.74987,5.93489 9.53028,10.16542 15.27939,14.00871 10.15322,6.72796 21.26277,12.12274 30.43779,20.24424 0.72261,0.57357 1.06428,1.45781 1.01481,2.36706 0.25419,10.62114 0.26429,21.24817 0.15168,31.87217 -0.10997,9.76491 -0.23395,19.53062 -0.32352,29.29514 -0.2559,2.18138 -2.48681,3.93272 -4.67536,3.50098 -1.73761,-0.32579 -2.97662,-1.73361 -4.40792,-2.66331 -35.6616,-26.03244 -71.15984,-52.30412 -107.51397,-77.36576 -1.79592,-1.18526 -3.52006,-2.4953 -5.36053,-3.6031 -2.38777,-1.13215 -5.02429,-1.65761 -7.63204,-1.97563 -6.86268,-0.69881 -13.69347,1.24508 -19.88444,4.07709 -9.03352,4.05728 -17.18145,9.7518 -25.58752,14.92132 -3.36838,2.10086 -6.87005,4.24739 -10.41869,6.1631 -0.99569,0.52942 -2.22,1.17581 -3.31848,1.71944 -4.07079,2.03607 -8.31873,3.71411 -12.69879,4.95454 -4.02638,1.19323 -7.8786,3.2257 -10.74869,6.34031 -2.96251,3.09048 -4.72915,7.11427 -5.71781,11.23537 -1.55545,6.40335 -1.57897,13.05115 -1.41863,19.6009 0.26795,9.17433 1.23843,18.2732 1.00241,27.46227 0.0207,3.42545 -1.03941,6.75735 -0.90681,10.1895 0.001,5.08446 1.56132,10.25252 4.8747,14.1707 4.43736,5.53069 10.76398,9.06598 17.04291,12.11545 11.82295,5.71965 24.58514,9.32817 36.12161,15.66465 2.63761,1.56679 5.14743,3.4485 8.1405,4.29671 4.09389,1.33597 8.5369,1.2958 12.69456,0.26955 7.31277,-1.64267 13.9237,-5.32376 20.51953,-8.74387 4.35604,-2.28907 8.66919,-4.70056 13.22314,-6.57805 2.19027,-0.44436 4.29633,0.48096 6.39883,0.88652 1.12616,0.30405 2.24944,0.63792 3.42471,1.02929 9.89759,3.32419 18.80495,8.95253 27.35797,14.83159 9.60214,6.67635 18.83584,13.8873 28.67442,20.21701 1.81523,1.44232 2.01025,4.45281 0.29511,6.05269 -1.18127,1.12727 -2.69962,1.81802 -4.02559,2.7576 -20.09966,13.11068 -40.67378,25.47586 -60.8399,38.48291 -9.96369,-3.64417 -18.76816,-9.70519 -28.31054,-14.23828 -5.34352,-2.47216 -11.27535,-4.34129 -17.22237,-3.5115 -2.23037,0.31113 -4.43888,1.00335 -6.29472,2.30511 -9.41413,5.6132 -20.00552,8.69886 -30.20947,12.5061 -7.8109,2.84323 -15.72475,5.92179 -22.32775,11.09558 -4.14348,3.33658 -7.40401,8.02695 -8.19394,13.36751 -0.75011,4.4178 0.0808,8.89125 -0.11393,13.33558 -0.0446,2.47431 -0.1663,4.78571 -0.33618,7.26123 -0.7016,9.88267 -2.18914,19.87652 -1.92566,29.86437 0.15833,5.61102 0.98818,11.38546 3.72433,16.36565 2.44787,4.28244 6.64099,7.37128 11.27534,8.93309 2.96165,1.01936 5.95313,1.9621 8.82273,3.22974 16.61941,6.96981 31.54004,17.40843 48.2906,24.09353 8.35504,3.30306 17.3626,5.41067 26.39188,4.73995 1.59654,-0.65955 2.95687,-1.7592 4.46121,-2.59492 34.97252,-21.48909 67.36925,-46.77662 100.70996,-70.64113 2.40223,-1.72533 4.80662,-3.4479 7.20969,-5.17216 3.12283,0.94464 6.45003,2.34189 8.1566,5.30326 2.63181,4.23393 2.95848,9.37168 3.10974,14.22553 0.0833,3.31727 0.004,6.60823 -0.11791,9.87356 -0.21995,6.79385 -0.7923,13.61211 -0.125,20.39843 0.20259,2.16638 0.20474,4.521 -0.33146,6.70372 -1.0519,4.92922 -3.98913,9.33555 -7.88721,12.48684 -4.60501,3.92369 -10.18337,6.53657 -15.54322,9.09565 -5.27007,2.60362 -10.87123,4.82949 -15.34311,8.75008 -3.14872,2.8351 -5.29862,6.60832 -6.92578,10.47774 -3.38575,8.39922 -4.00047,17.60263 -3.79623,26.56693 0.33468,12.34083 2.50879,24.53129 4.78404,36.63584 23.29475,15.98048 48.86901,28.22319 74.1637,40.59903 3.68993,1.78904 7.35713,3.65372 11.08044,5.36581 1.3382,0.36422 2.72081,0.68421 4.08264,0.85588 14.97883,-4.04776 28.84434,-11.24143 42.34205,-18.73961 11.53711,-6.35617 22.86975,-13.13079 34.83628,-18.66637 4.22894,-1.55707 8.44379,-3.61358 11.45999,-7.06209 4.09602,-4.4785 5.93166,-10.51995 6.66278,-16.43202 0.92354,-7.35214 0.49188,-14.78778 -0.0139,-22.15442 -0.67411,-9.31054 -1.67798,-18.63084 -1.29362,-27.9791 -5.24479,-6.86889 -12.45843,-11.86973 -19.80582,-16.25267 -5.70939,-3.42205 -11.57773,-6.5755 -17.2495,-9.97521 -3.48793,-2.1042 -6.91214,-4.29698 -10.24384,-6.71085 -0.72961,-0.25274 -0.3909,-1.04781 -0.45847,-1.63664 0.10339,-17.34117 -0.25832,-34.68823 0.31622,-52.02424 0.0871,-2.86433 0.24803,-5.86427 0.35547,-8.77734 0.24524,-1.51291 0.97602,-2.92863 1.82743,-4.17922 1.01119,-0.96492 2.69388,-0.72675 3.64269,0.20957 13.7572,9.30561 27.45185,18.70282 41.06504,28.21769 14.32134,10.01422 28.62533,20.04233 42.89178,30.13048 9.85111,7.13736 19.42479,14.89572 30.55621,19.99718 6.32797,2.8654 13.46903,4.59642 20.40357,3.28445 5.01892,-0.91491 9.51952,-3.53842 13.56592,-6.54339 4.1904,-2.64327 8.6938,-4.74592 13.1878,-6.81289 12.49,-5.62316 25.6326,-9.85522 37.5685,-16.66375 6.6826,-3.86072 12.9614,-8.79041 17.159,-15.36138 0.077,-0.98215 -0.1432,-2.04092 -0.1765,-3.05218 -1.0891,-15.56938 0.8661,-31.18693 -0.42,-46.74805 -0.6817,-7.73457 -2.3041,-15.61186 -6.4028,-22.31119 -0.698,-1.07942 -1.3987,-2.21543 -2.2632,-3.14351 -6.5959,-2.34922 -12.9212,-5.37852 -19.1484,-8.56287 -8.7431,-4.45721 -17.485,-9.32684 -26.689,-12.95173 -7.9225,-3.0727 -16.4727,-5.18735 -25.01999,-4.27874 -0.69625,0.0946 -1.45907,0.031 -1.9507,0.62492 -1.86973,1.50356 -4.00206,2.99524 -5.93993,4.18562 -3.11255,1.91641 -6.61385,3.63178 -10.16309,4.85819 -5.17482,1.81524 -10.69246,2.62925 -16.17089,2.39377 -0.76721,-0.0353 -1.83478,-0.10813 -2.71485,-0.19727 -8.76802,-0.87792 -17.09685,-4.23876 -24.66465,-8.63987 -6.70946,-3.87704 -12.94638,-8.62728 -18.84121,-13.55739 -5.3555,-2.04179 -10.86973,-4.46433 -14.67498,-8.91892 -2.71108,-3.28176 -3.6238,-8.13451 -1.72969,-12.03365 1.92136,-4.4162 5.87455,-7.47217 9.75916,-10.09482 7.41881,-4.95593 15.60058,-8.5845 23.40489,-12.86517 3.87755,-2.08906 7.78444,-4.23221 11.15815,-7.08878 2.01088,-1.89507 3.89167,-4.04315 6.46834,-5.18776 3.79471,-1.90744 8.31932,-2.18549 12.35001,-0.87941 6.3308,1.82617 11.47084,6.14955 17.28242,9.06683 1.89042,0.93426 3.95479,1.46325 5.78158,2.52681 6.71632,3.31352 14.54253,4.15556 21.85253,2.61957 9.4786,-1.84944 18.1485,-6.35056 26.5334,-10.96985 11.3346,-6.30144 22.2737,-13.46349 34.3962,-18.21392 4.2955,-10.61758 5.7235,-22.14012 6.0312,-33.51651 0.3858,-15.15412 -1.1682,-30.25794 -2.2616,-45.35263 -12.3858,-9.88221 -26.6329,-16.99787 -40.689,-24.14553 -9.5,-4.83571 -19.0575,-9.61979 -28.0582,-15.35042 -6.12007,-4.66644 -14.05816,-6.41988 -21.64672,-5.96219 -1.19198,-0.0473 -2.37843,0.32604 -3.2616,1.13778 -38.22332,26.10576 -75.04874,54.16648 -112.57695,81.24614 -2.71304,0.6413 -5.49842,-0.66111 -7.54085,-2.3846 -2.98399,-2.60674 -4.29719,-6.57185 -4.74676,-10.40275 -0.82369,-5.94443 -0.34169,-11.84447 -0.0213,-17.79103 0.33714,-6.47411 1.01497,-12.99967 0.0809,-19.45673 -0.74071,-5.92858 1.52712,-12.06105 5.76034,-16.24201 4.84104,-4.96478 11.25754,-7.86952 17.35846,-10.94667 3.99683,-2.00052 8.09479,-3.99903 11.43912,-7.01665 0.99698,-0.95764 1.86712,-2.07596 3.12921,-2.70104 5.52795,-3.56549 9.52876,-9.28516 11.25959,-15.60778 2.32363,-7.95342 2.23731,-16.36205 1.6583,-24.55425 -0.85794,-10.76518 -2.81251,-21.40013 -4.13281,-32.11133 -21.60154,-15.33596 -45.2301,-27.50365 -68.56022,-39.89174 -5.52038,-2.93006 -11.02072,-5.90598 -16.52315,-8.86385 -2.21137,-0.75553 -4.61644,-0.71584 -6.9264,-0.73464 z"/></svg></span>SVEND</h2>
            <p class="subtitle">Sign in to continue</p>
            <div id="loginError" class="error-msg hidden"></div>
            <input type="text" id="username" placeholder="Username">
            <input type="password" id="password" placeholder="Password">
            <button onclick="login()">Sign In</button>
            <div class="auth-toggle">
                Have an invite code? <a onclick="showRegister()">Create account</a>
            </div>
        </div>
    </div>

    <!-- Main App (hidden until logged in) -->
    <div id="app" class="hidden" style="display: flex; width: 100%;">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                <span class="logo-icon">
                    <svg viewBox="590 180 400 680" xmlns="http://www.w3.org/2000/svg">
                        <path d="m 810.34961,183.98438 c -8.00929,0.28308 -15.5701,3.48413 -22.48495,7.32376 -12.87788,7.1817 -24.40922,16.65459 -37.84868,22.84732 -4.31757,2.08674 -9.12821,2.91574 -13.3771,5.16756 -7.15857,3.4834 -13.4768,8.9205 -17.4074,15.89893 -4.63628,8.03202 -6.3024,17.46727 -6.06699,26.65644 0.0985,4.79617 0.75632,9.56171 1.64764,14.269 0.0476,1.43947 -0.58472,2.80552 -0.6551,4.24336 -0.75319,5.38879 0.11601,11.14811 3.19493,15.71841 3.74987,5.93489 9.53028,10.16542 15.27939,14.00871 10.15322,6.72796 21.26277,12.12274 30.43779,20.24424 0.72261,0.57357 1.06428,1.45781 1.01481,2.36706 0.25419,10.62114 0.26429,21.24817 0.15168,31.87217 -0.10997,9.76491 -0.23395,19.53062 -0.32352,29.29514 -0.2559,2.18138 -2.48681,3.93272 -4.67536,3.50098 -1.73761,-0.32579 -2.97662,-1.73361 -4.40792,-2.66331 -35.6616,-26.03244 -71.15984,-52.30412 -107.51397,-77.36576 -1.79592,-1.18526 -3.52006,-2.4953 -5.36053,-3.6031 -2.38777,-1.13215 -5.02429,-1.65761 -7.63204,-1.97563 -6.86268,-0.69881 -13.69347,1.24508 -19.88444,4.07709 -9.03352,4.05728 -17.18145,9.7518 -25.58752,14.92132 -3.36838,2.10086 -6.87005,4.24739 -10.41869,6.1631 -0.99569,0.52942 -2.22,1.17581 -3.31848,1.71944 -4.07079,2.03607 -8.31873,3.71411 -12.69879,4.95454 -4.02638,1.19323 -7.8786,3.2257 -10.74869,6.34031 -2.96251,3.09048 -4.72915,7.11427 -5.71781,11.23537 -1.55545,6.40335 -1.57897,13.05115 -1.41863,19.6009 0.26795,9.17433 1.23843,18.2732 1.00241,27.46227 0.0207,3.42545 -1.03941,6.75735 -0.90681,10.1895 0.001,5.08446 1.56132,10.25252 4.8747,14.1707 4.43736,5.53069 10.76398,9.06598 17.04291,12.11545 11.82295,5.71965 24.58514,9.32817 36.12161,15.66465 2.63761,1.56679 5.14743,3.4485 8.1405,4.29671 4.09389,1.33597 8.5369,1.2958 12.69456,0.26955 7.31277,-1.64267 13.9237,-5.32376 20.51953,-8.74387 4.35604,-2.28907 8.66919,-4.70056 13.22314,-6.57805 2.19027,-0.44436 4.29633,0.48096 6.39883,0.88652 1.12616,0.30405 2.24944,0.63792 3.42471,1.02929 9.89759,3.32419 18.80495,8.95253 27.35797,14.83159 9.60214,6.67635 18.83584,13.8873 28.67442,20.21701 1.81523,1.44232 2.01025,4.45281 0.29511,6.05269 -1.18127,1.12727 -2.69962,1.81802 -4.02559,2.7576 -20.09966,13.11068 -40.67378,25.47586 -60.8399,38.48291 -9.96369,-3.64417 -18.76816,-9.70519 -28.31054,-14.23828 -5.34352,-2.47216 -11.27535,-4.34129 -17.22237,-3.5115 -2.23037,0.31113 -4.43888,1.00335 -6.29472,2.30511 -9.41413,5.6132 -20.00552,8.69886 -30.20947,12.5061 -7.8109,2.84323 -15.72475,5.92179 -22.32775,11.09558 -4.14348,3.33658 -7.40401,8.02695 -8.19394,13.36751 -0.75011,4.4178 0.0808,8.89125 -0.11393,13.33558 -0.0446,2.47431 -0.1663,4.78571 -0.33618,7.26123 -0.7016,9.88267 -2.18914,19.87652 -1.92566,29.86437 0.15833,5.61102 0.98818,11.38546 3.72433,16.36565 2.44787,4.28244 6.64099,7.37128 11.27534,8.93309 2.96165,1.01936 5.95313,1.9621 8.82273,3.22974 16.61941,6.96981 31.54004,17.40843 48.2906,24.09353 8.35504,3.30306 17.3626,5.41067 26.39188,4.73995 1.59654,-0.65955 2.95687,-1.7592 4.46121,-2.59492 34.97252,-21.48909 67.36925,-46.77662 100.70996,-70.64113 2.40223,-1.72533 4.80662,-3.4479 7.20969,-5.17216 3.12283,0.94464 6.45003,2.34189 8.1566,5.30326 2.63181,4.23393 2.95848,9.37168 3.10974,14.22553 0.0833,3.31727 0.004,6.60823 -0.11791,9.87356 -0.21995,6.79385 -0.7923,13.61211 -0.125,20.39843 0.20259,2.16638 0.20474,4.521 -0.33146,6.70372 -1.0519,4.92922 -3.98913,9.33555 -7.88721,12.48684 -4.60501,3.92369 -10.18337,6.53657 -15.54322,9.09565 -5.27007,2.60362 -10.87123,4.82949 -15.34311,8.75008 -3.14872,2.8351 -5.29862,6.60832 -6.92578,10.47774 -3.38575,8.39922 -4.00047,17.60263 -3.79623,26.56693 0.33468,12.34083 2.50879,24.53129 4.78404,36.63584 23.29475,15.98048 48.86901,28.22319 74.1637,40.59903 3.68993,1.78904 7.35713,3.65372 11.08044,5.36581 1.3382,0.36422 2.72081,0.68421 4.08264,0.85588 14.97883,-4.04776 28.84434,-11.24143 42.34205,-18.73961 11.53711,-6.35617 22.86975,-13.13079 34.83628,-18.66637 4.22894,-1.55707 8.44379,-3.61358 11.45999,-7.06209 4.09602,-4.4785 5.93166,-10.51995 6.66278,-16.43202 0.92354,-7.35214 0.49188,-14.78778 -0.0139,-22.15442 -0.67411,-9.31054 -1.67798,-18.63084 -1.29362,-27.9791 -5.24479,-6.86889 -12.45843,-11.86973 -19.80582,-16.25267 -5.70939,-3.42205 -11.57773,-6.5755 -17.2495,-9.97521 -3.48793,-2.1042 -6.91214,-4.29698 -10.24384,-6.71085 -0.72961,-0.25274 -0.3909,-1.04781 -0.45847,-1.63664 0.10339,-17.34117 -0.25832,-34.68823 0.31622,-52.02424 0.0871,-2.86433 0.24803,-5.86427 0.35547,-8.77734 0.24524,-1.51291 0.97602,-2.92863 1.82743,-4.17922 1.01119,-0.96492 2.69388,-0.72675 3.64269,0.20957 13.7572,9.30561 27.45185,18.70282 41.06504,28.21769 14.32134,10.01422 28.62533,20.04233 42.89178,30.13048 9.85111,7.13736 19.42479,14.89572 30.55621,19.99718 6.32797,2.8654 13.46903,4.59642 20.40357,3.28445 5.01892,-0.91491 9.51952,-3.53842 13.56592,-6.54339 4.1904,-2.64327 8.6938,-4.74592 13.1878,-6.81289 12.49,-5.62316 25.6326,-9.85522 37.5685,-16.66375 6.6826,-3.86072 12.9614,-8.79041 17.159,-15.36138 0.077,-0.98215 -0.1432,-2.04092 -0.1765,-3.05218 -1.0891,-15.56938 0.8661,-31.18693 -0.42,-46.74805 -0.6817,-7.73457 -2.3041,-15.61186 -6.4028,-22.31119 -0.698,-1.07942 -1.3987,-2.21543 -2.2632,-3.14351 -6.5959,-2.34922 -12.9212,-5.37852 -19.1484,-8.56287 -8.7431,-4.45721 -17.485,-9.32684 -26.689,-12.95173 -7.9225,-3.0727 -16.4727,-5.18735 -25.01999,-4.27874 -0.69625,0.0946 -1.45907,0.031 -1.9507,0.62492 -1.86973,1.50356 -4.00206,2.99524 -5.93993,4.18562 -3.11255,1.91641 -6.61385,3.63178 -10.16309,4.85819 -5.17482,1.81524 -10.69246,2.62925 -16.17089,2.39377 -0.76721,-0.0353 -1.83478,-0.10813 -2.71485,-0.19727 -8.76802,-0.87792 -17.09685,-4.23876 -24.66465,-8.63987 -6.70946,-3.87704 -12.94638,-8.62728 -18.84121,-13.55739 -5.3555,-2.04179 -10.86973,-4.46433 -14.67498,-8.91892 -2.71108,-3.28176 -3.6238,-8.13451 -1.72969,-12.03365 1.92136,-4.4162 5.87455,-7.47217 9.75916,-10.09482 7.41881,-4.95593 15.60058,-8.5845 23.40489,-12.86517 3.87755,-2.08906 7.78444,-4.23221 11.15815,-7.08878 2.01088,-1.89507 3.89167,-4.04315 6.46834,-5.18776 3.79471,-1.90744 8.31932,-2.18549 12.35001,-0.87941 6.3308,1.82617 11.47084,6.14955 17.28242,9.06683 1.89042,0.93426 3.95479,1.46325 5.78158,2.52681 6.71632,3.31352 14.54253,4.15556 21.85253,2.61957 9.4786,-1.84944 18.1485,-6.35056 26.5334,-10.96985 11.3346,-6.30144 22.2737,-13.46349 34.3962,-18.21392 4.2955,-10.61758 5.7235,-22.14012 6.0312,-33.51651 0.3858,-15.15412 -1.1682,-30.25794 -2.2616,-45.35263 -12.3858,-9.88221 -26.6329,-16.99787 -40.689,-24.14553 -9.5,-4.83571 -19.0575,-9.61979 -28.0582,-15.35042 -6.12007,-4.66644 -14.05816,-6.41988 -21.64672,-5.96219 -1.19198,-0.0473 -2.37843,0.32604 -3.2616,1.13778 -38.22332,26.10576 -75.04874,54.16648 -112.57695,81.24614 -2.71304,0.6413 -5.49842,-0.66111 -7.54085,-2.3846 -2.98399,-2.60674 -4.29719,-6.57185 -4.74676,-10.40275 -0.82369,-5.94443 -0.34169,-11.84447 -0.0213,-17.79103 0.33714,-6.47411 1.01497,-12.99967 0.0809,-19.45673 -0.74071,-5.92858 1.52712,-12.06105 5.76034,-16.24201 4.84104,-4.96478 11.25754,-7.86952 17.35846,-10.94667 3.99683,-2.00052 8.09479,-3.99903 11.43912,-7.01665 0.99698,-0.95764 1.86712,-2.07596 3.12921,-2.70104 5.52795,-3.56549 9.52876,-9.28516 11.25959,-15.60778 2.32363,-7.95342 2.23731,-16.36205 1.6583,-24.55425 -0.85794,-10.76518 -2.81251,-21.40013 -4.13281,-32.11133 -21.60154,-15.33596 -45.2301,-27.50365 -68.56022,-39.89174 -5.52038,-2.93006 -11.02072,-5.90598 -16.52315,-8.86385 -2.21137,-0.75553 -4.61644,-0.71584 -6.9264,-0.73464 z"/>
                    </svg>
                </span>
                SVEND
            </div>
                <button class="new-chat-btn" onclick="newChat()">
                    + New Chat
                </button>
            </div>
            <div class="chat-history" id="chatHistory">
                <!-- Populated dynamically -->
            </div>
            <div class="sidebar-footer">
                <div class="user-info">
                    <div class="user-avatar" id="userAvatar">?</div>
                    <div class="user-details">
                        <div class="user-name" id="userName">Loading...</div>
                        <div class="user-tier" id="userTier">-</div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main">
            <header class="chat-header">
                <span class="chat-title" id="chatTitle">New Conversation</span>
            </header>

            <div class="messages" id="messages">
                <div class="welcome">
                    <h1><span class="logo-icon"><svg viewBox="590 180 400 680" xmlns="http://www.w3.org/2000/svg"><path d="m 810.34961,183.98438 c -8.00929,0.28308 -15.5701,3.48413 -22.48495,7.32376 -12.87788,7.1817 -24.40922,16.65459 -37.84868,22.84732 -4.31757,2.08674 -9.12821,2.91574 -13.3771,5.16756 -7.15857,3.4834 -13.4768,8.9205 -17.4074,15.89893 -4.63628,8.03202 -6.3024,17.46727 -6.06699,26.65644 0.0985,4.79617 0.75632,9.56171 1.64764,14.269 0.0476,1.43947 -0.58472,2.80552 -0.6551,4.24336 -0.75319,5.38879 0.11601,11.14811 3.19493,15.71841 3.74987,5.93489 9.53028,10.16542 15.27939,14.00871 10.15322,6.72796 21.26277,12.12274 30.43779,20.24424 0.72261,0.57357 1.06428,1.45781 1.01481,2.36706 0.25419,10.62114 0.26429,21.24817 0.15168,31.87217 -0.10997,9.76491 -0.23395,19.53062 -0.32352,29.29514 -0.2559,2.18138 -2.48681,3.93272 -4.67536,3.50098 -1.73761,-0.32579 -2.97662,-1.73361 -4.40792,-2.66331 -35.6616,-26.03244 -71.15984,-52.30412 -107.51397,-77.36576 -1.79592,-1.18526 -3.52006,-2.4953 -5.36053,-3.6031 -2.38777,-1.13215 -5.02429,-1.65761 -7.63204,-1.97563 -6.86268,-0.69881 -13.69347,1.24508 -19.88444,4.07709 -9.03352,4.05728 -17.18145,9.7518 -25.58752,14.92132 -3.36838,2.10086 -6.87005,4.24739 -10.41869,6.1631 -0.99569,0.52942 -2.22,1.17581 -3.31848,1.71944 -4.07079,2.03607 -8.31873,3.71411 -12.69879,4.95454 -4.02638,1.19323 -7.8786,3.2257 -10.74869,6.34031 -2.96251,3.09048 -4.72915,7.11427 -5.71781,11.23537 -1.55545,6.40335 -1.57897,13.05115 -1.41863,19.6009 0.26795,9.17433 1.23843,18.2732 1.00241,27.46227 0.0207,3.42545 -1.03941,6.75735 -0.90681,10.1895 0.001,5.08446 1.56132,10.25252 4.8747,14.1707 4.43736,5.53069 10.76398,9.06598 17.04291,12.11545 11.82295,5.71965 24.58514,9.32817 36.12161,15.66465 2.63761,1.56679 5.14743,3.4485 8.1405,4.29671 4.09389,1.33597 8.5369,1.2958 12.69456,0.26955 7.31277,-1.64267 13.9237,-5.32376 20.51953,-8.74387 4.35604,-2.28907 8.66919,-4.70056 13.22314,-6.57805 2.19027,-0.44436 4.29633,0.48096 6.39883,0.88652 1.12616,0.30405 2.24944,0.63792 3.42471,1.02929 9.89759,3.32419 18.80495,8.95253 27.35797,14.83159 9.60214,6.67635 18.83584,13.8873 28.67442,20.21701 1.81523,1.44232 2.01025,4.45281 0.29511,6.05269 -1.18127,1.12727 -2.69962,1.81802 -4.02559,2.7576 -20.09966,13.11068 -40.67378,25.47586 -60.8399,38.48291 -9.96369,-3.64417 -18.76816,-9.70519 -28.31054,-14.23828 -5.34352,-2.47216 -11.27535,-4.34129 -17.22237,-3.5115 -2.23037,0.31113 -4.43888,1.00335 -6.29472,2.30511 -9.41413,5.6132 -20.00552,8.69886 -30.20947,12.5061 -7.8109,2.84323 -15.72475,5.92179 -22.32775,11.09558 -4.14348,3.33658 -7.40401,8.02695 -8.19394,13.36751 -0.75011,4.4178 0.0808,8.89125 -0.11393,13.33558 -0.0446,2.47431 -0.1663,4.78571 -0.33618,7.26123 -0.7016,9.88267 -2.18914,19.87652 -1.92566,29.86437 0.15833,5.61102 0.98818,11.38546 3.72433,16.36565 2.44787,4.28244 6.64099,7.37128 11.27534,8.93309 2.96165,1.01936 5.95313,1.9621 8.82273,3.22974 16.61941,6.96981 31.54004,17.40843 48.2906,24.09353 8.35504,3.30306 17.3626,5.41067 26.39188,4.73995 1.59654,-0.65955 2.95687,-1.7592 4.46121,-2.59492 34.97252,-21.48909 67.36925,-46.77662 100.70996,-70.64113 2.40223,-1.72533 4.80662,-3.4479 7.20969,-5.17216 3.12283,0.94464 6.45003,2.34189 8.1566,5.30326 2.63181,4.23393 2.95848,9.37168 3.10974,14.22553 0.0833,3.31727 0.004,6.60823 -0.11791,9.87356 -0.21995,6.79385 -0.7923,13.61211 -0.125,20.39843 0.20259,2.16638 0.20474,4.521 -0.33146,6.70372 -1.0519,4.92922 -3.98913,9.33555 -7.88721,12.48684 -4.60501,3.92369 -10.18337,6.53657 -15.54322,9.09565 -5.27007,2.60362 -10.87123,4.82949 -15.34311,8.75008 -3.14872,2.8351 -5.29862,6.60832 -6.92578,10.47774 -3.38575,8.39922 -4.00047,17.60263 -3.79623,26.56693 0.33468,12.34083 2.50879,24.53129 4.78404,36.63584 23.29475,15.98048 48.86901,28.22319 74.1637,40.59903 3.68993,1.78904 7.35713,3.65372 11.08044,5.36581 1.3382,0.36422 2.72081,0.68421 4.08264,0.85588 14.97883,-4.04776 28.84434,-11.24143 42.34205,-18.73961 11.53711,-6.35617 22.86975,-13.13079 34.83628,-18.66637 4.22894,-1.55707 8.44379,-3.61358 11.45999,-7.06209 4.09602,-4.4785 5.93166,-10.51995 6.66278,-16.43202 0.92354,-7.35214 0.49188,-14.78778 -0.0139,-22.15442 -0.67411,-9.31054 -1.67798,-18.63084 -1.29362,-27.9791 -5.24479,-6.86889 -12.45843,-11.86973 -19.80582,-16.25267 -5.70939,-3.42205 -11.57773,-6.5755 -17.2495,-9.97521 -3.48793,-2.1042 -6.91214,-4.29698 -10.24384,-6.71085 -0.72961,-0.25274 -0.3909,-1.04781 -0.45847,-1.63664 0.10339,-17.34117 -0.25832,-34.68823 0.31622,-52.02424 0.0871,-2.86433 0.24803,-5.86427 0.35547,-8.77734 0.24524,-1.51291 0.97602,-2.92863 1.82743,-4.17922 1.01119,-0.96492 2.69388,-0.72675 3.64269,0.20957 13.7572,9.30561 27.45185,18.70282 41.06504,28.21769 14.32134,10.01422 28.62533,20.04233 42.89178,30.13048 9.85111,7.13736 19.42479,14.89572 30.55621,19.99718 6.32797,2.8654 13.46903,4.59642 20.40357,3.28445 5.01892,-0.91491 9.51952,-3.53842 13.56592,-6.54339 4.1904,-2.64327 8.6938,-4.74592 13.1878,-6.81289 12.49,-5.62316 25.6326,-9.85522 37.5685,-16.66375 6.6826,-3.86072 12.9614,-8.79041 17.159,-15.36138 0.077,-0.98215 -0.1432,-2.04092 -0.1765,-3.05218 -1.0891,-15.56938 0.8661,-31.18693 -0.42,-46.74805 -0.6817,-7.73457 -2.3041,-15.61186 -6.4028,-22.31119 -0.698,-1.07942 -1.3987,-2.21543 -2.2632,-3.14351 -6.5959,-2.34922 -12.9212,-5.37852 -19.1484,-8.56287 -8.7431,-4.45721 -17.485,-9.32684 -26.689,-12.95173 -7.9225,-3.0727 -16.4727,-5.18735 -25.01999,-4.27874 -0.69625,0.0946 -1.45907,0.031 -1.9507,0.62492 -1.86973,1.50356 -4.00206,2.99524 -5.93993,4.18562 -3.11255,1.91641 -6.61385,3.63178 -10.16309,4.85819 -5.17482,1.81524 -10.69246,2.62925 -16.17089,2.39377 -0.76721,-0.0353 -1.83478,-0.10813 -2.71485,-0.19727 -8.76802,-0.87792 -17.09685,-4.23876 -24.66465,-8.63987 -6.70946,-3.87704 -12.94638,-8.62728 -18.84121,-13.55739 -5.3555,-2.04179 -10.86973,-4.46433 -14.67498,-8.91892 -2.71108,-3.28176 -3.6238,-8.13451 -1.72969,-12.03365 1.92136,-4.4162 5.87455,-7.47217 9.75916,-10.09482 7.41881,-4.95593 15.60058,-8.5845 23.40489,-12.86517 3.87755,-2.08906 7.78444,-4.23221 11.15815,-7.08878 2.01088,-1.89507 3.89167,-4.04315 6.46834,-5.18776 3.79471,-1.90744 8.31932,-2.18549 12.35001,-0.87941 6.3308,1.82617 11.47084,6.14955 17.28242,9.06683 1.89042,0.93426 3.95479,1.46325 5.78158,2.52681 6.71632,3.31352 14.54253,4.15556 21.85253,2.61957 9.4786,-1.84944 18.1485,-6.35056 26.5334,-10.96985 11.3346,-6.30144 22.2737,-13.46349 34.3962,-18.21392 4.2955,-10.61758 5.7235,-22.14012 6.0312,-33.51651 0.3858,-15.15412 -1.1682,-30.25794 -2.2616,-45.35263 -12.3858,-9.88221 -26.6329,-16.99787 -40.689,-24.14553 -9.5,-4.83571 -19.0575,-9.61979 -28.0582,-15.35042 -6.12007,-4.66644 -14.05816,-6.41988 -21.64672,-5.96219 -1.19198,-0.0473 -2.37843,0.32604 -3.2616,1.13778 -38.22332,26.10576 -75.04874,54.16648 -112.57695,81.24614 -2.71304,0.6413 -5.49842,-0.66111 -7.54085,-2.3846 -2.98399,-2.60674 -4.29719,-6.57185 -4.74676,-10.40275 -0.82369,-5.94443 -0.34169,-11.84447 -0.0213,-17.79103 0.33714,-6.47411 1.01497,-12.99967 0.0809,-19.45673 -0.74071,-5.92858 1.52712,-12.06105 5.76034,-16.24201 4.84104,-4.96478 11.25754,-7.86952 17.35846,-10.94667 3.99683,-2.00052 8.09479,-3.99903 11.43912,-7.01665 0.99698,-0.95764 1.86712,-2.07596 3.12921,-2.70104 5.52795,-3.56549 9.52876,-9.28516 11.25959,-15.60778 2.32363,-7.95342 2.23731,-16.36205 1.6583,-24.55425 -0.85794,-10.76518 -2.81251,-21.40013 -4.13281,-32.11133 -21.60154,-15.33596 -45.2301,-27.50365 -68.56022,-39.89174 -5.52038,-2.93006 -11.02072,-5.90598 -16.52315,-8.86385 -2.21137,-0.75553 -4.61644,-0.71584 -6.9264,-0.73464 z"/></svg></span>SVEND</h1>
                    <p>A reasoning assistant powered by an ensemble of specialized models. Ask me anything about math, science, code, or logic.</p>
                </div>
            </div>

            <div class="input-area">
                <div class="mode-selector" id="modeSelector">
                    <button class="mode-btn active" data-mode="auto" onclick="setMode('auto')" title="Thompson sampling selects best mode">Auto</button>
                    <button class="mode-btn" data-mode="analytical" onclick="setMode('analytical')" title="Decomposition, causal chains">Analytical</button>
                    <button class="mode-btn" data-mode="synthetic" onclick="setMode('synthetic')" title="Integration, pattern recognition">Synthetic</button>
                    <button class="mode-btn" data-mode="critical" onclick="setMode('critical')" title="Contradiction detection, verification">Critical</button>
                    <button class="mode-btn" data-mode="generative" onclick="setMode('generative')" title="Hypothesis formation, exploration">Generative</button>
                    <button class="mode-btn executive" data-mode="executive" onclick="setMode('executive')" title="Code execution">Executive</button>
                </div>
                <div class="input-container">
                    <select class="model-selector" id="modelSelector" style="display: none;">
                        <option value="default">Default</option>
                        <option value="opus">Opus</option>
                        <option value="sonnet">Sonnet</option>
                        <option value="haiku">Haiku</option>
                    </select>
                    <div class="input-wrapper">
                        <input type="text"
                               class="message-input"
                               id="messageInput"
                               placeholder="Ask anything..."
                               onkeypress="if(event.key==='Enter')sendMessage()">
                    </div>
                    <button class="send-btn" onclick="sendMessage()" id="sendBtn">
                        
                    </button>
                </div>
            </div>
        </main>
    </div>

    <script>
        // State
        let currentConversationId = null;
        let conversations = [];
        let savedUsername = '';
        let currentMode = 'auto';  // auto, analytical, synthetic, critical, generative, executive

        // Mode selector
        function setMode(mode) {
            currentMode = mode;
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.mode === mode) {
                    btn.classList.add('active');
                }
            });
        }
        let savedPassword = '';

        // API base
        const API_BASE = '/api';

        // Auth header helper
        function getAuthHeader() {
            return 'Basic ' + btoa(savedUsername + ':' + savedPassword);
        }

        // Show/hide forms
        function showLogin() {
            document.getElementById('registerForm').classList.add('hidden');
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('loginError').classList.add('hidden');
        }

        function showRegister() {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('registerForm').classList.remove('hidden');
            document.getElementById('registerError').classList.add('hidden');
            document.getElementById('registerSuccess').classList.add('hidden');
        }

        // Format invite code as user types (XXXX-XXXX)
        document.addEventListener('DOMContentLoaded', () => {
            const inviteInput = document.getElementById('regInviteCode');
            inviteInput.addEventListener('input', (e) => {
                let value = e.target.value.replace(/[^A-Za-z0-9]/g, '').toUpperCase();
                if (value.length > 4) {
                    value = value.slice(0, 4) + '-' + value.slice(4, 8);
                }
                e.target.value = value;
            });
        });

        // Register
        async function register() {
            const inviteCode = document.getElementById('regInviteCode').value.trim();
            const username = document.getElementById('regUsername').value.trim();
            const email = document.getElementById('regEmail').value.trim();
            const password = document.getElementById('regPassword').value;

            // Clear messages
            document.getElementById('registerError').classList.add('hidden');
            document.getElementById('registerSuccess').classList.add('hidden');

            // Basic validation
            if (!inviteCode) {
                document.getElementById('registerError').textContent = 'Please enter your invite code';
                document.getElementById('registerError').classList.remove('hidden');
                return;
            }
            if (!username || username.length < 3) {
                document.getElementById('registerError').textContent = 'Username must be at least 3 characters';
                document.getElementById('registerError').classList.remove('hidden');
                return;
            }
            if (!password || password.length < 8) {
                document.getElementById('registerError').textContent = 'Password must be at least 8 characters';
                document.getElementById('registerError').classList.remove('hidden');
                return;
            }

            try {
                const res = await fetch(`${API_BASE}/register/`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        invite_code: inviteCode,
                        username: username,
                        email: email,
                        password: password
                    })
                });

                const data = await res.json();

                if (res.ok) {
                    // Success - show message and switch to login
                    document.getElementById('registerSuccess').textContent = 'Account created! Signing you in...';
                    document.getElementById('registerSuccess').classList.remove('hidden');

                    // Auto-login
                    savedUsername = username;
                    savedPassword = password;
                    setTimeout(() => loginWithCredentials(username, password), 1000);
                } else {
                    document.getElementById('registerError').textContent = data.error || 'Registration failed';
                    document.getElementById('registerError').classList.remove('hidden');
                }
            } catch (e) {
                document.getElementById('registerError').textContent = 'Connection error. Please try again.';
                document.getElementById('registerError').classList.remove('hidden');
            }
        }

        // Login with specific credentials
        async function loginWithCredentials(username, password) {
            savedUsername = username;
            savedPassword = password;

            try {
                const res = await fetch(`${API_BASE}/user/`, {
                    headers: { 'Authorization': getAuthHeader() }
                });

                if (res.ok) {
                    const data = await res.json();
                    document.getElementById('authContainer').classList.add('hidden');
                    document.getElementById('authBackground').classList.add('hidden');
                    document.getElementById('app').classList.remove('hidden');
                    document.getElementById('app').style.display = 'flex';

                    // Update user info
                    document.getElementById('userName').textContent = data.username || username;
                    document.getElementById('userTier').textContent = data.tier + ' tier';
                    document.getElementById('userAvatar').textContent = (data.username || username)[0].toUpperCase();

                    // Show model selector for enterprise users
                    if (data.tier === 'enterprise') {
                        document.getElementById('modelSelector').style.display = 'block';
                    }

                    // Load conversations
                    loadConversations();
                } else {
                    document.getElementById('loginError').textContent = 'Invalid credentials';
                    document.getElementById('loginError').classList.remove('hidden');
                }
            } catch (e) {
                document.getElementById('loginError').textContent = 'Connection error';
                document.getElementById('loginError').classList.remove('hidden');
            }
        }

        // Login from form
        async function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            await loginWithCredentials(username, password);
        }

        // Load conversations
        async function loadConversations() {
            try {
                const res = await fetch(`${API_BASE}/conversations/`, {
                    headers: { 'Authorization': getAuthHeader() }
                });
                if (res.ok) {
                    conversations = await res.json();
                    renderConversations();
                }
            } catch (e) {
                console.error('Failed to load conversations:', e);
            }
        }

        // Render conversation list
        function renderConversations() {
            const container = document.getElementById('chatHistory');
            container.innerHTML = conversations.map(c => `
                <div class="chat-history-item ${c.id === currentConversationId ? 'active' : ''}"
                     onclick="loadConversation('${c.id}')">
                    ${c.title || 'New conversation'}
                </div>
            `).join('');
        }

        // Load a conversation
        async function loadConversation(id) {
            try {
                const res = await fetch(`${API_BASE}/conversations/${id}/`, {
                    headers: { 'Authorization': getAuthHeader() }
                });
                if (res.ok) {
                    const data = await res.json();
                    currentConversationId = id;
                    document.getElementById('chatTitle').textContent = data.title || 'New conversation';
                    renderMessages(data.messages);
                    renderConversations();
                }
            } catch (e) {
                console.error('Failed to load conversation:', e);
            }
        }

        // New chat
        function newChat() {
            currentConversationId = null;
            document.getElementById('chatTitle').textContent = 'New Conversation';
            document.getElementById('messages').innerHTML = `
                <div class="welcome">
                    <h1><span class="logo-icon"><svg viewBox="590 180 400 680" xmlns="http://www.w3.org/2000/svg"><path d="m 810.34961,183.98438 c -8.00929,0.28308 -15.5701,3.48413 -22.48495,7.32376 -12.87788,7.1817 -24.40922,16.65459 -37.84868,22.84732 -4.31757,2.08674 -9.12821,2.91574 -13.3771,5.16756 -7.15857,3.4834 -13.4768,8.9205 -17.4074,15.89893 -4.63628,8.03202 -6.3024,17.46727 -6.06699,26.65644 0.0985,4.79617 0.75632,9.56171 1.64764,14.269 0.0476,1.43947 -0.58472,2.80552 -0.6551,4.24336 -0.75319,5.38879 0.11601,11.14811 3.19493,15.71841 3.74987,5.93489 9.53028,10.16542 15.27939,14.00871 10.15322,6.72796 21.26277,12.12274 30.43779,20.24424 0.72261,0.57357 1.06428,1.45781 1.01481,2.36706 0.25419,10.62114 0.26429,21.24817 0.15168,31.87217 -0.10997,9.76491 -0.23395,19.53062 -0.32352,29.29514 -0.2559,2.18138 -2.48681,3.93272 -4.67536,3.50098 -1.73761,-0.32579 -2.97662,-1.73361 -4.40792,-2.66331 -35.6616,-26.03244 -71.15984,-52.30412 -107.51397,-77.36576 -1.79592,-1.18526 -3.52006,-2.4953 -5.36053,-3.6031 -2.38777,-1.13215 -5.02429,-1.65761 -7.63204,-1.97563 -6.86268,-0.69881 -13.69347,1.24508 -19.88444,4.07709 -9.03352,4.05728 -17.18145,9.7518 -25.58752,14.92132 -3.36838,2.10086 -6.87005,4.24739 -10.41869,6.1631 -0.99569,0.52942 -2.22,1.17581 -3.31848,1.71944 -4.07079,2.03607 -8.31873,3.71411 -12.69879,4.95454 -4.02638,1.19323 -7.8786,3.2257 -10.74869,6.34031 -2.96251,3.09048 -4.72915,7.11427 -5.71781,11.23537 -1.55545,6.40335 -1.57897,13.05115 -1.41863,19.6009 0.26795,9.17433 1.23843,18.2732 1.00241,27.46227 0.0207,3.42545 -1.03941,6.75735 -0.90681,10.1895 0.001,5.08446 1.56132,10.25252 4.8747,14.1707 4.43736,5.53069 10.76398,9.06598 17.04291,12.11545 11.82295,5.71965 24.58514,9.32817 36.12161,15.66465 2.63761,1.56679 5.14743,3.4485 8.1405,4.29671 4.09389,1.33597 8.5369,1.2958 12.69456,0.26955 7.31277,-1.64267 13.9237,-5.32376 20.51953,-8.74387 4.35604,-2.28907 8.66919,-4.70056 13.22314,-6.57805 2.19027,-0.44436 4.29633,0.48096 6.39883,0.88652 1.12616,0.30405 2.24944,0.63792 3.42471,1.02929 9.89759,3.32419 18.80495,8.95253 27.35797,14.83159 9.60214,6.67635 18.83584,13.8873 28.67442,20.21701 1.81523,1.44232 2.01025,4.45281 0.29511,6.05269 -1.18127,1.12727 -2.69962,1.81802 -4.02559,2.7576 -20.09966,13.11068 -40.67378,25.47586 -60.8399,38.48291 -9.96369,-3.64417 -18.76816,-9.70519 -28.31054,-14.23828 -5.34352,-2.47216 -11.27535,-4.34129 -17.22237,-3.5115 -2.23037,0.31113 -4.43888,1.00335 -6.29472,2.30511 -9.41413,5.6132 -20.00552,8.69886 -30.20947,12.5061 -7.8109,2.84323 -15.72475,5.92179 -22.32775,11.09558 -4.14348,3.33658 -7.40401,8.02695 -8.19394,13.36751 -0.75011,4.4178 0.0808,8.89125 -0.11393,13.33558 -0.0446,2.47431 -0.1663,4.78571 -0.33618,7.26123 -0.7016,9.88267 -2.18914,19.87652 -1.92566,29.86437 0.15833,5.61102 0.98818,11.38546 3.72433,16.36565 2.44787,4.28244 6.64099,7.37128 11.27534,8.93309 2.96165,1.01936 5.95313,1.9621 8.82273,3.22974 16.61941,6.96981 31.54004,17.40843 48.2906,24.09353 8.35504,3.30306 17.3626,5.41067 26.39188,4.73995 1.59654,-0.65955 2.95687,-1.7592 4.46121,-2.59492 34.97252,-21.48909 67.36925,-46.77662 100.70996,-70.64113 2.40223,-1.72533 4.80662,-3.4479 7.20969,-5.17216 3.12283,0.94464 6.45003,2.34189 8.1566,5.30326 2.63181,4.23393 2.95848,9.37168 3.10974,14.22553 0.0833,3.31727 0.004,6.60823 -0.11791,9.87356 -0.21995,6.79385 -0.7923,13.61211 -0.125,20.39843 0.20259,2.16638 0.20474,4.521 -0.33146,6.70372 -1.0519,4.92922 -3.98913,9.33555 -7.88721,12.48684 -4.60501,3.92369 -10.18337,6.53657 -15.54322,9.09565 -5.27007,2.60362 -10.87123,4.82949 -15.34311,8.75008 -3.14872,2.8351 -5.29862,6.60832 -6.92578,10.47774 -3.38575,8.39922 -4.00047,17.60263 -3.79623,26.56693 0.33468,12.34083 2.50879,24.53129 4.78404,36.63584 23.29475,15.98048 48.86901,28.22319 74.1637,40.59903 3.68993,1.78904 7.35713,3.65372 11.08044,5.36581 1.3382,0.36422 2.72081,0.68421 4.08264,0.85588 14.97883,-4.04776 28.84434,-11.24143 42.34205,-18.73961 11.53711,-6.35617 22.86975,-13.13079 34.83628,-18.66637 4.22894,-1.55707 8.44379,-3.61358 11.45999,-7.06209 4.09602,-4.4785 5.93166,-10.51995 6.66278,-16.43202 0.92354,-7.35214 0.49188,-14.78778 -0.0139,-22.15442 -0.67411,-9.31054 -1.67798,-18.63084 -1.29362,-27.9791 -5.24479,-6.86889 -12.45843,-11.86973 -19.80582,-16.25267 -5.70939,-3.42205 -11.57773,-6.5755 -17.2495,-9.97521 -3.48793,-2.1042 -6.91214,-4.29698 -10.24384,-6.71085 -0.72961,-0.25274 -0.3909,-1.04781 -0.45847,-1.63664 0.10339,-17.34117 -0.25832,-34.68823 0.31622,-52.02424 0.0871,-2.86433 0.24803,-5.86427 0.35547,-8.77734 0.24524,-1.51291 0.97602,-2.92863 1.82743,-4.17922 1.01119,-0.96492 2.69388,-0.72675 3.64269,0.20957 13.7572,9.30561 27.45185,18.70282 41.06504,28.21769 14.32134,10.01422 28.62533,20.04233 42.89178,30.13048 9.85111,7.13736 19.42479,14.89572 30.55621,19.99718 6.32797,2.8654 13.46903,4.59642 20.40357,3.28445 5.01892,-0.91491 9.51952,-3.53842 13.56592,-6.54339 4.1904,-2.64327 8.6938,-4.74592 13.1878,-6.81289 12.49,-5.62316 25.6326,-9.85522 37.5685,-16.66375 6.6826,-3.86072 12.9614,-8.79041 17.159,-15.36138 0.077,-0.98215 -0.1432,-2.04092 -0.1765,-3.05218 -1.0891,-15.56938 0.8661,-31.18693 -0.42,-46.74805 -0.6817,-7.73457 -2.3041,-15.61186 -6.4028,-22.31119 -0.698,-1.07942 -1.3987,-2.21543 -2.2632,-3.14351 -6.5959,-2.34922 -12.9212,-5.37852 -19.1484,-8.56287 -8.7431,-4.45721 -17.485,-9.32684 -26.689,-12.95173 -7.9225,-3.0727 -16.4727,-5.18735 -25.01999,-4.27874 -0.69625,0.0946 -1.45907,0.031 -1.9507,0.62492 -1.86973,1.50356 -4.00206,2.99524 -5.93993,4.18562 -3.11255,1.91641 -6.61385,3.63178 -10.16309,4.85819 -5.17482,1.81524 -10.69246,2.62925 -16.17089,2.39377 -0.76721,-0.0353 -1.83478,-0.10813 -2.71485,-0.19727 -8.76802,-0.87792 -17.09685,-4.23876 -24.66465,-8.63987 -6.70946,-3.87704 -12.94638,-8.62728 -18.84121,-13.55739 -5.3555,-2.04179 -10.86973,-4.46433 -14.67498,-8.91892 -2.71108,-3.28176 -3.6238,-8.13451 -1.72969,-12.03365 1.92136,-4.4162 5.87455,-7.47217 9.75916,-10.09482 7.41881,-4.95593 15.60058,-8.5845 23.40489,-12.86517 3.87755,-2.08906 7.78444,-4.23221 11.15815,-7.08878 2.01088,-1.89507 3.89167,-4.04315 6.46834,-5.18776 3.79471,-1.90744 8.31932,-2.18549 12.35001,-0.87941 6.3308,1.82617 11.47084,6.14955 17.28242,9.06683 1.89042,0.93426 3.95479,1.46325 5.78158,2.52681 6.71632,3.31352 14.54253,4.15556 21.85253,2.61957 9.4786,-1.84944 18.1485,-6.35056 26.5334,-10.96985 11.3346,-6.30144 22.2737,-13.46349 34.3962,-18.21392 4.2955,-10.61758 5.7235,-22.14012 6.0312,-33.51651 0.3858,-15.15412 -1.1682,-30.25794 -2.2616,-45.35263 -12.3858,-9.88221 -26.6329,-16.99787 -40.689,-24.14553 -9.5,-4.83571 -19.0575,-9.61979 -28.0582,-15.35042 -6.12007,-4.66644 -14.05816,-6.41988 -21.64672,-5.96219 -1.19198,-0.0473 -2.37843,0.32604 -3.2616,1.13778 -38.22332,26.10576 -75.04874,54.16648 -112.57695,81.24614 -2.71304,0.6413 -5.49842,-0.66111 -7.54085,-2.3846 -2.98399,-2.60674 -4.29719,-6.57185 -4.74676,-10.40275 -0.82369,-5.94443 -0.34169,-11.84447 -0.0213,-17.79103 0.33714,-6.47411 1.01497,-12.99967 0.0809,-19.45673 -0.74071,-5.92858 1.52712,-12.06105 5.76034,-16.24201 4.84104,-4.96478 11.25754,-7.86952 17.35846,-10.94667 3.99683,-2.00052 8.09479,-3.99903 11.43912,-7.01665 0.99698,-0.95764 1.86712,-2.07596 3.12921,-2.70104 5.52795,-3.56549 9.52876,-9.28516 11.25959,-15.60778 2.32363,-7.95342 2.23731,-16.36205 1.6583,-24.55425 -0.85794,-10.76518 -2.81251,-21.40013 -4.13281,-32.11133 -21.60154,-15.33596 -45.2301,-27.50365 -68.56022,-39.89174 -5.52038,-2.93006 -11.02072,-5.90598 -16.52315,-8.86385 -2.21137,-0.75553 -4.61644,-0.71584 -6.9264,-0.73464 z"/></svg></span>SVEND</h1>
                    <p>A reasoning assistant powered by an ensemble of specialized models. Ask me anything about math, science, code, or logic.</p>
                </div>
            `;
            renderConversations();
        }

        // Render messages
        function renderMessages(messages) {
            const container = document.getElementById('messages');
            container.innerHTML = messages.map(m => {
                if (m.role === 'user') {
                    return `
                        <div class="message message-user">
                            <div class="message-content">${escapeHtml(m.content)}</div>
                        </div>
                    `;
                } else {
                    return renderAssistantMessage(m);
                }
            }).join('');
            container.scrollTop = container.scrollHeight;
            setTimeout(renderMath, 100);  // Render LaTeX after DOM update
        }

        // Render assistant message
        function renderAssistantMessage(m, responseData = {}) {
            const badges = [];
            const selectedMode = responseData.selected_mode || 'executive';
            const modeScores = responseData.mode_scores || {};

            // Mode name formatting
            const modeNames = {
                'analytical': 'Analytical',
                'synthetic': 'Synthetic',
                'critical': 'Critical',
                'generative': 'Generative',
                'executive': 'Executive'
            };

            if (m.blocked) {
                badges.push(`<span class="meta-badge blocked">Blocked</span>`);
            } else {
                // Cognition mode badge
                const modeName = modeNames[selectedMode] || selectedMode;
                const modeClass = selectedMode === 'executive' ? 'executive' : 'cognition';
                badges.push(`<span class="meta-badge ${modeClass}">${modeName}</span>`);

                // Show confidence if available
                const confidence = modeScores[selectedMode];
                if (confidence) badges.push(`<span class="meta-badge">Conf: ${(confidence * 100).toFixed(0)}%</span>`);

                if (m.verified !== null) badges.push(`<span class="meta-badge ${m.verified ? 'verified' : ''}">Verified: ${m.verified ? 'Yes' : 'No'}</span>`);
                if (m.inference_time_ms) badges.push(`<span class="meta-badge">${m.inference_time_ms}ms</span>`);
            }

            // Build content sections
            let content = '';

            // Main response text
            if (m.content) {
                content += `<div class="assistant-response ${m.blocked ? 'blocked' : ''}">${m.blocked ? m.block_reason : formatResponse(m.content)}</div>`;
            }

            // Code block (if coder mode)
            if (responseData.code) {
                content += `
                    <div class="code-block">
                        <div class="code-header">
                            <span class="lang">Python</span>
                            <button onclick="copyCode(this)" style="background:none;border:none;color:var(--text-dim);cursor:pointer;font-size:0.75rem;">Copy</button>
                        </div>
                        <div class="code-content"><pre>${escapeHtml(responseData.code)}</pre></div>
                    </div>
                `;
            }

            // Visualizations
            if (responseData.visualizations && responseData.visualizations.length > 0) {
                responseData.visualizations.forEach((viz, i) => {
                    content += `
                        <div class="visualization-container">
                            <img class="visualization-img" src="data:image/png;base64,${viz}" alt="Visualization ${i + 1}">
                            <div class="visualization-label">Figure ${i + 1}</div>
                        </div>
                    `;
                });
            }

            return `
                <div class="message message-assistant">
                    <div class="message-header">
                        <div class="assistant-icon">S</div>
                        <span class="assistant-name">Svend</span>
                    </div>
                    ${content}
                    <div class="message-meta">
                        ${badges.join('')}
                    </div>
                </div>
            `;
        }

        // Copy code to clipboard
        function copyCode(btn) {
            const code = btn.closest('.code-block').querySelector('pre').textContent;
            navigator.clipboard.writeText(code).then(() => {
                const original = btn.textContent;
                btn.textContent = 'Copied!';
                setTimeout(() => btn.textContent = original, 1500);
            });
        }

        // Format response (simple markdown-like)
        function formatResponse(text) {
            // First, protect LaTeX blocks from escaping
            const latexBlocks = [];
            let protectedText = text;

            // Protect display math \[...\] and $$...$$
            protectedText = protectedText.replace(/\\\[([\s\S]*?)\\\]/g, (match, content) => {
                latexBlocks.push({ type: 'display', content: content });
                return `%%LATEX_BLOCK_${latexBlocks.length - 1}%%`;
            });
            protectedText = protectedText.replace(/\$\$([\s\S]*?)\$\$/g, (match, content) => {
                latexBlocks.push({ type: 'display', content: content });
                return `%%LATEX_BLOCK_${latexBlocks.length - 1}%%`;
            });

            // Protect inline math \(...\) and $...$
            protectedText = protectedText.replace(/\\\((.*?)\\\)/g, (match, content) => {
                latexBlocks.push({ type: 'inline', content: content });
                return `%%LATEX_BLOCK_${latexBlocks.length - 1}%%`;
            });
            protectedText = protectedText.replace(/\$([^\$\n]+)\$/g, (match, content) => {
                latexBlocks.push({ type: 'inline', content: content });
                return `%%LATEX_BLOCK_${latexBlocks.length - 1}%%`;
            });

            // Now escape HTML and format markdown
            let result = escapeHtml(protectedText)
                .replace(/\n\n/g, '</p><p>')
                .replace(/\n/g, '<br>')
                .replace(/`([^`]+)`/g, '<code>$1</code>')
                .replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>')
                .replace(/\*([^*]+)\*/g, '<em>$1</em>')
                .replace(/^### (.+)$/gm, '<h4>$1</h4>')
                .replace(/^## (.+)$/gm, '<h3>$1</h3>')
                .replace(/^# (.+)$/gm, '<h2>$1</h2>');

            // Restore LaTeX blocks with KaTeX spans
            latexBlocks.forEach((block, i) => {
                const katexClass = block.type === 'display' ? 'katex-display' : 'katex-inline';
                const wrapper = block.type === 'display'
                    ? `<div class="${katexClass}" data-latex="${escapeHtml(block.content)}"></div>`
                    : `<span class="${katexClass}" data-latex="${escapeHtml(block.content)}"></span>`;
                result = result.replace(`%%LATEX_BLOCK_${i}%%`, wrapper);
            });

            return `<p>${result}</p>`;
        }

        // Render KaTeX math after DOM update
        function renderMath() {
            document.querySelectorAll('.katex-display, .katex-inline').forEach(el => {
                if (el.dataset.latex && !el.dataset.rendered) {
                    try {
                        katex.render(el.dataset.latex, el, {
                            displayMode: el.classList.contains('katex-display'),
                            throwOnError: false
                        });
                        el.dataset.rendered = 'true';
                    } catch (e) {
                        el.textContent = el.dataset.latex;
                    }
                }
            });
        }

        // Send message
        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const text = input.value.trim();
            if (!text) return;

            const sendBtn = document.getElementById('sendBtn');
            sendBtn.disabled = true;
            input.value = '';

            // Remove welcome message if present
            const welcome = document.querySelector('.welcome');
            if (welcome) welcome.remove();

            // Add user message
            const messagesContainer = document.getElementById('messages');
            messagesContainer.innerHTML += `
                <div class="message message-user">
                    <div class="message-content">${escapeHtml(text)}</div>
                </div>
            `;

            // Add loading indicator
            messagesContainer.innerHTML += `
                <div class="message message-assistant" id="loadingMsg">
                    <div class="message-header">
                        <div class="assistant-icon">S</div>
                        <span class="assistant-name">Svend</span>
                    </div>
                    <div class="loading">
                        <span></span><span></span><span></span>
                    </div>
                </div>
            `;
            messagesContainer.scrollTop = messagesContainer.scrollHeight;

            try {
                const body = { message: text, mode: currentMode };
                if (currentConversationId) body.conversation_id = currentConversationId;

                // Include model selection for enterprise users
                const modelSelector = document.getElementById('modelSelector');
                if (modelSelector && modelSelector.style.display !== 'none') {
                    body.model = modelSelector.value;
                }

                const res = await fetch(`${API_BASE}/chat/`, {
                    method: 'POST',
                    headers: {
                        'Authorization': getAuthHeader(),
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(body)
                });

                // Remove loading
                document.getElementById('loadingMsg').remove();

                if (res.ok) {
                    const data = await res.json();
                    currentConversationId = data.conversation_id;

                    // Add assistant message (pass full data for code/visualizations)
                    messagesContainer.innerHTML += renderAssistantMessage(data.assistant_message, data);
                    messagesContainer.scrollTop = messagesContainer.scrollHeight;
                    renderMath();  // Render LaTeX

                    // Update title
                    document.getElementById('chatTitle').textContent = text.substring(0, 50) + (text.length > 50 ? '...' : '');

                    // Reload conversations
                    loadConversations();
                } else {
                    messagesContainer.innerHTML += `
                        <div class="message message-assistant">
                            <div class="assistant-response blocked">Error: Could not get response</div>
                        </div>
                    `;
                }
            } catch (e) {
                document.getElementById('loadingMsg')?.remove();
                messagesContainer.innerHTML += `
                    <div class="message message-assistant">
                        <div class="assistant-response blocked">Error: ${e.message}</div>
                    </div>
                `;
            }

            sendBtn.disabled = false;
            input.focus();
        }

        // Escape HTML
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Firefly generation for auth screen background
        function createFireflies() {
            const container = document.getElementById('fireflies');
            if (!container) return;

            const count = 35;

            for (let i = 0; i < count; i++) {
                const firefly = document.createElement('div');
                firefly.className = 'firefly';

                // Random position (concentrated in middle-lower area)
                const x = Math.random() * 100;
                const y = 20 + Math.random() * 60;

                // Random colors - warm yellows, oranges, and occasional cool green
                const colors = [
                    '#e8c547', '#e8c547', '#e8c547', // warm yellow (most common)
                    '#e8a847', '#e89547',             // orange tints
                    '#d4c96a',                        // pale yellow
                    '#a7d4a7',                        // cool green (rare)
                ];
                const color = colors[Math.floor(Math.random() * colors.length)];

                // Random size
                const size = 2 + Math.random() * 3;

                // Random animation timing
                const floatDuration = 8 + Math.random() * 8;
                const glowDuration = 2 + Math.random() * 3;
                const floatDelay = Math.random() * -15;
                const glowDelay = Math.random() * -5;

                firefly.style.cssText = `
                    left: ${x}%;
                    top: ${y}%;
                    width: ${size}px;
                    height: ${size}px;
                    color: ${color};
                    animation: firefly-float ${floatDuration}s ease-in-out infinite;
                    animation-delay: ${floatDelay}s;
                `;

                firefly.innerHTML = `<style>
                    #fireflies .firefly:nth-child(${i + 1})::before {
                        background: ${color};
                        animation: firefly-glow ${glowDuration}s ease-in-out infinite;
                        animation-delay: ${glowDelay}s;
                    }
                </style>`;

                container.appendChild(firefly);
            }
        }

        // Check for stored session on load
        window.onload = () => {
            // Create fireflies for the auth screen
            createFireflies();
        };
    </script>
</body>
</html>
